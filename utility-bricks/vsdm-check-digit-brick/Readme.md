# VSDM Check Digit Brick 
The VSDM check digit is a structured identifier generated by VSDM services. This check digit is available in various versions, each containing different elements, including the KVNR and a timestamp at the time of generation.

## VsdmCheckDigitFactory Usage

The `VsdmCheckDigitFactory` class provides static methods to create instances of `VsdmCheckDigitV1` and `VsdmCheckDigitV2`. This factory class cannot be instantiated and is used to generate check digit objects based on the version specified.

### Methods

- `createV1(String kvnr, char identifier)`: Creates an instance of `VsdmCheckDigitV1`.
- `createV2(String kvnr, char identifier)`: Creates an instance of `VsdmCheckDigitV2` with dummy data.
- `createV2(VsdmPatient patient, char identifier)`: Creates an instance of `VsdmCheckDigitV2`.

## Example Usage

```java
import de.gematik.bbriccs.vsdm.VsdmCheckDigitFactory;
import de.gematik.bbriccs.vsdm.types.VsdmCheckDigit;

public class Example {
  public static void main(String[] args) {
    VsdmCheckDigitV1 checkDigitV1 = VsdmCheckDigitFactory.createV1("X123456789", 'A');
    VsdmCheckDigitV2 checkDigitV2 = VsdmCheckDigitFactory.createV2("X123456789", 'B');

  VsdmPatient patient = new VsdmPatient(
          VsdmKvnr.from("A123456789"),
          false, // isEgkRevoked
          Instant.parse("2025-01-01T00:00:00Z"), // insuranceStartDate
          "ExampleStreet" // street
  );
    
    VsdmCheckDigitV2 checkDigitV2_1 = VsdmCheckDigitFactory.createV2(patient,'X');
  }
}
```

### VsdmKey
To create an instance of the VsdmKey class, you need to provide two parameters
#### Parameters
- key: A byte array of length 32. This array represents the key used for cryptographic operations.
- keyVersion: An instance of VsdmKeyVersion which specifies the version of the key. The keyVersion is independent of the Vsdm check digit version. 

```java
VsdmKey vsdmKey = new VsdmKey(new byte[32], new VsdmKeyVersion('3', VsdmCheckDigitVersion.V2));
```


### Signing a Check Digit Version 1
To sign a check digit, use the sign method provided by the VsdmCheckDigit class.

```java
VsdmCheckDigitV1 checkDigitV1 = VsdmCheckDigitFactory.createV1("X123456789", 'A');
String signedCheckDigit = checkDigitV1.sign(vsdmKey);
```

### Parsing a Check Digit Version 1
To parse a check digit encoded as base64, use the parse method provided by the VsdmCheckDigit class.

```java
String data = ...; // String, encoded as base64, containing the check digit data
VsdmCheckDigitV1 parsedCheckDigit = VsdmCheckDigit.parse(data);
```

### Encrypting a Check Digit Version 2
To encrypt a check digit, use the encrypt method provided by the VsdmCheckDigit class.

```java
VsdmCheckDigitV2 checkDigit = VsdmCheckDigitFactory.createV2("X123456789", 'A');
byte[] encryptedData = checkDigitV1.encrypt(vsdmKey);
```

### Decrypting a Check Digit Version 2
To decrypt a check digit, use the decrypt method provided by the VsdmCheckDigit class.

```java
String encryptedData = ...; // check digit, encoded as base64, containing the encrypted check digit data
VsdmCheckDigitV1 decryptedCheckDigit = VsdmCheckDigit.decrypt(vsdmKey, encryptedData);
```